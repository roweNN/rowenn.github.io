import{d as H,r as x,s as S,o as K,b as g,c as m,e as o,t as R,j as W,k as r,v as i,F as I,h as O,x as T,q as F,m as X}from"./index.a53329dd.js";import{d as A,E as Z}from"./es.b393bca0.js";const tt={class:"container mx-auto"},et={class:"selection:bg-blue-100"},ot={class:"grid grid-cols-8 py-5 text-center mb-3"},st={class:"col-span-6"},lt={class:"text-2xl font-bold"},nt={class:"col-span-2"},at={class:"grid grid-cols-7 items-end py-5 border px-3 mb-5 bg-gray-100"},ct={class:"col-span-2"},dt=o("small",null,"TOTAL RECAUDACION",-1),rt={class:"col-span-2"},it=o("small",null,"VALOR M2",-1),ut={class:"col-span-2"},pt=o("small",null,"AGUA",-1),gt={class:"col-span-2"},mt=o("small",null,"TOTAL LOCALES",-1),vt={class:"col-span-5"},ht=["onUpdate:modelValue"],xt={class:"col-span-1"},_t=["onClick"],bt={class:"col-span-1"},ft=["onClick"],yt={class:"col-span-7 mt-5"},wt={class:"grid grid-cols-6"},St=o("div",{class:"col-span-4"},[o("small",null,"ITEMS")],-1),Ft={class:"col-span-2 ml-auto"},At=["onClick"],Ct={class:"grid grid-cols-10 gap-1"},Ut={class:"col-span-1"},Vt=o("small",null,"LOCAL",-1),Et=["onUpdate:modelValue"],Rt={class:"col-span-3"},It=o("small",null,"RESPONSABLE",-1),Ot=["onUpdate:modelValue"],Tt={class:"col-span-1"},Lt=o("small",null,"UNIDADES",-1),kt=["onUpdate:modelValue"],Mt={class:"col-span-1"},$t=o("small",null,"M2",-1),Nt=["onUpdate:modelValue"],Dt={class:"col-span-2"},zt=o("small",null,"VALOR M2",-1),Bt=["onUpdate:modelValue"],Gt={class:"col-span-2"},qt=o("small",null,"GASTOS",-1),Yt=["onUpdate:modelValue"],Jt={key:0,class:"col-span-6"},Pt=o("p",{class:"text-sm text-center"},"No hay items",-1),jt=[Pt],Qt={class:"col-span-7 mt-2 border border-t-1"},Ht={class:"grid grid-cols-7 gap-3"},Kt=o("div",{class:"col-span-6 text-right"},[o("span",null,"TOTAL")],-1),Wt={class:"col-span-1"},ee=H({__name:"Clients",setup(Xt){A.locale("es");const C=A().subtract(0,"month").format("MMMM"),L=A().format("YYYY"),a=x([]),v=x(0),y=x(0),h=x(0),_=x(0),k=()=>{a.value=[]},M=e=>{a.value=a.value.filter(t=>t.id!==e.id)},$=e=>{const t=a.value.findIndex(s=>s.id===e.id);if(t>0){const s=a.value[t-1];a.value[t-1]=e,a.value[t]=s}};S(()=>h.value,e=>{localStorage.setItem("waterValue",e)}),S(()=>a.value,(e,t)=>{console.log("newVal",e),console.log("oldVal",t),localStorage.setItem("clients",JSON.stringify(e))},{deep:!0}),S(()=>v.value,e=>{localStorage.setItem("totalRec",e)}),K(()=>{const e=localStorage.getItem("clients");e&&(a.value=JSON.parse(e));const t=localStorage.getItem("totalRec");t&&(v.value=parseFloat(t));const s=localStorage.getItem("waterValue");s&&(h.value=parseFloat(s))});const N=()=>{const e=a.value[a.value.length-1];a.value.push({id:e?e.id+1:1,name:"Otros",items:[]})},D=e=>{const t=e.items[e.items.length-1];e.items.push({id:t?t.id+1:1,name:"",description:"",amount:0})},U=e=>{let t=0;return e.items.forEach(s=>{t+=s.amount+s.extra}),t},b=e=>Intl.NumberFormat("de-DE").format(e.toFixed(0).replace(/\d(?=(\d{3})+\.)/g,"$&,")),z=()=>{const e=new Z;let t=15;e.setFontSize(16),e.setFont("helvetica","bold"),e.text("GASTOS COMUNES GALERIA CAMARA DE COMERCIO",100,t,{align:"center"}),e.setFontSize(12),e.setFont("helvetica","normal"),t+=15,e.text("RUT: 65.188.731-3",20,t),t+=5,e.text("Direccion: Bulnes 136 Talcahuano",20,t),e.rect(20,t+2,170,.1,"F"),t+=15,e.setFont("helvetica","bold"),e.setFontSize(14),e.text(`${C.toUpperCase()} DE ${L}`,100,t,{align:"center"}),t+=10,a.value.forEach(l=>{t+=5,e.setFontSize(10),e.setFont("helvetica","bold"),e.text("LOCAL",20,t),e.text("RESPONSABLE",40,t),e.text("VALOR M2",140,t,{align:"right"}),e.text("AGUA",165,t,{align:"right"}),e.text("TOTAL",190,t,{align:"right"}),e.setFontSize(12),e.text(l.name,20,t-5),e.setFont("helvetica","normal"),e.setFontSize(10),e.rect(20,t+2,170,.1,"F"),t+=2,e.setFontSize(10),l.items.forEach(n=>{t+=5,e.text(n.description,20,t),e.text(n.name,40,t);const d=n.amount;d&&e.text(`$${b(d)}`,140,t,{align:"right"}),e.text(`$${b(n.extra)}`,165,t,{align:"right"}),e.text(`$${b(d+n.extra)}`,190,t,{align:"right"})})}),e.setFontSize(12),t+=10,e.rect(20,t+2,170,.1,"F"),e.setFont("helvetica","bold"),e.text("TOTAL",20,t+10);const s=a.value.reduce((l,n)=>l+U(n),0);s&&e.text(`$${b(s)}`,190,t+10,{align:"right"}),t+=20,e.setFontSize(12),e.text("Datos de Transferencia",20,t),e.setFont("helvetica","normal"),t+=7,e.text(`Nombre: Pedro Sanhueza Flores 
Banco: Scotiabank / cuenta corriente 
Rut:17.349.789-k 
N\xBA de cuenta: 974816458 
Correo: adm.cecdc@gmail.com`,20,t),e.output("dataurlnewwindow")},B=()=>{document.querySelector("input[type=file]").click()},G=()=>{var e;try{console.log("calculate");const t=a.value.reduce((d,c)=>d+c.items.reduce((u,p)=>u+p.m2,0),0),s=a.value.reduce((d,c)=>d+c.items.reduce((u,p)=>u+parseInt(p.qty),0),0);_.value=s,console.log("totalm2",t);const l=v.value/t;y.value=l,console.log("valorM2",l);const n=T();(e=n==null?void 0:n.proxy)==null||e.$forceUpdate(),a.value.forEach(d=>{d.items.forEach(c=>{c.amount=Math.round(l*c.m2*100)/100,c.extra=Math.round(h.value/_.value)})})}catch(t){console.log(t)}},q=e=>{const t=e.target.files[0],s=new FileReader;s.onload=l=>{var V;const d=l.target.result.split(`
`),c=[];let u={},p=[];d.forEach((Y,J)=>{const f=Y.split("	");console.log("columns",f);const E=f[1],P=f[0],j=parseFloat(f[3].replace(",",".")),Q=0;E&&(u.name&&(u.items=p,c.push(u)),u=c[c.length-1]||{}),p.push({id:new Date().getTime()+J,name:E,description:P,m2:j,amount:Q,qty:1})}),u.items=p,c.push(u),console.log("details",c),localStorage.setItem("clients",JSON.stringify(c));const w=T();(V=w==null?void 0:w.proxy)==null||V.$forceUpdate()},s.readAsText(t)};return(e,t)=>(g(),m("div",tt,[o("div",et,[o("div",ot,[o("div",st,[o("h3",lt,"Mes "+R(W(C)),1)]),o("div",nt,[o("input",{type:"file",class:"hidden",onChange:q,accept:".tsv"},null,32),o("button",{class:"bg-yellow-500 hover:bg-yellow-700 py-2 text-white font-bold px-4 rounded w-full",onClick:t[0]||(t[0]=s=>B())}," SUBIR ")])]),o("div",at,[o("div",ct,[dt,r(o("input",{type:"text",class:"w-full border text-2xl rounded px-2 py-1 bg-white","onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s)},null,512),[[i,v.value]])]),o("div",rt,[it,r(o("input",{type:"text",class:"w-full border text-2xl rounded px-2 py-1 bg-white","onUpdate:modelValue":t[2]||(t[2]=s=>y.value=s)},null,512),[[i,y.value]])]),o("div",ut,[pt,r(o("input",{type:"text",class:"w-full border text-2xl rounded px-2 py-1 bg-white",onFocus:t[3]||(t[3]=s=>s.target.select()),"onUpdate:modelValue":t[4]||(t[4]=s=>h.value=s)},null,544),[[i,h.value]])]),o("div",gt,[mt,r(o("input",{type:"text",class:"w-full border text-2xl rounded px-2 py-1 bg-white","onUpdate:modelValue":t[5]||(t[5]=s=>_.value=s)},null,512),[[i,_.value]])]),o("div",{class:"col-span-2"},[o("button",{onClick:G,class:"bg-green-500 hover:bg-green-700 py-2 text-white font-bold px-4 rounded w-full"}," CALCULAR ")])]),(g(!0),m(I,null,O(a.value,s=>(g(),m("div",{class:"grid grid-cols-7 py-5 border px-3 mb-5 bg-gray-100",key:s.id},[o("div",vt,[r(o("input",{type:"text",class:"w-full border text-2xl rounded px-2 py-1 bg-white","onUpdate:modelValue":l=>s.name=l},null,8,ht),[[i,s.name]])]),o("div",xt,[o("button",{class:"bg-yellow-500 hover:bg-yellow-700 py-2 text-white font-bold px-4 rounded w-full",onClick:l=>$(s)}," SUBIR ",8,_t)]),o("div",bt,[o("button",{class:"bg-red-500 hover:bg-red-700 py-2 text-white font-bold px-4 rounded w-full",onClick:l=>M(s)}," QUITAR ",8,ft)]),o("div",yt,[o("div",wt,[St,o("div",Ft,[o("button",{onClick:l=>D(s),class:"bg-green-500 hover:bg-green-700 text-white font-bold px-4 rounded"}," + ",8,At)])])]),(g(!0),m(I,null,O(s.items,l=>(g(),m("div",{class:"col-span-7 mb-3",key:`item-${l.id}`},[o("div",Ct,[o("div",Ut,[Vt,r(o("input",{type:"text",class:"w-full border rounded px-2 py-1 text-center","onUpdate:modelValue":n=>l.description=n,onFocus:t[6]||(t[6]=n=>n.target.select())},null,40,Et),[[i,l.description]])]),o("div",Rt,[It,r(o("input",{type:"text",class:F(["w-full border rounded px-2 py-1",{"border-red-400":l.name==""}]),"onUpdate:modelValue":n=>l.name=n,onFocus:t[7]||(t[7]=n=>n.target.select())},null,42,Ot),[[i,l.name]])]),o("div",Tt,[Lt,r(o("input",{type:"text",class:"w-full border rounded px-2 py-1","onUpdate:modelValue":n=>l.qty=n,onFocus:t[8]||(t[8]=n=>n.target.select())},null,40,kt),[[i,l.qty]])]),o("div",Mt,[$t,r(o("input",{type:"number",class:"w-full border rounded px-2 py-1 text-right","onUpdate:modelValue":n=>l.m2=n,onFocus:t[9]||(t[9]=n=>n.target.select())},null,40,Nt),[[i,l.m2]])]),o("div",Dt,[zt,r(o("input",{type:"number",class:F(["w-full border rounded px-2 py-1 text-right",{"border-red-400":(l==null?void 0:l.amount)==0}]),"onUpdate:modelValue":n=>l.amount=n,onFocus:t[10]||(t[10]=n=>n.target.select())},null,42,Bt),[[i,l.amount]])]),o("div",Gt,[qt,r(o("input",{type:"number",class:F(["w-full border rounded px-2 py-1 text-right",{"border-red-400":(l==null?void 0:l.extra)==0}]),"onUpdate:modelValue":n=>l.extra=n,onFocus:t[11]||(t[11]=n=>n.target.select())},null,42,Yt),[[i,l.extra]])])])]))),128)),s.items.length==0?(g(),m("div",Jt,jt)):X("",!0),o("div",Qt,[o("div",Ht,[Kt,o("div",Wt,"$"+R(U(s)),1)])])]))),128)),o("div",{class:"grid grid-cols-6 py-5 gap-2"},[o("div",{class:"col-span-2"},[o("button",{onClick:k,class:"bg-yellow-500 hover:bg-yellow-700 text-white font-bold px-4 rounded w-full py-3"}," RESET ")]),o("div",{class:"col-span-2"},[o("button",{onClick:N,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold px-4 rounded w-full py-3"}," AGREGAR ")]),o("div",{class:"col-span-2"},[o("button",{onClick:z,class:"bg-green-500 hover:bg-green-700 text-white font-bold px-4 rounded w-full py-3"}," GENERAR ")])])])]))}});export{ee as default};
